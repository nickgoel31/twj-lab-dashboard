// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model CurrentClient {
  id              String                 @id @default(cuid())
  name            String
  companyName     String?
  email           String                 @unique
  phone           String?
  dealValue       Float?
  currency        String?                // e.g. USD, EUR, INR
  country         String?
  services        Json                   // e.g. ["Web Development", "Branding"]
  status          ClientStatus           @default(ACTIVE)
  startDate       DateTime               @default(now())
  paymentTerms    PaymentTerms           @default(FIFTY_FIFTY)
  notes           String?

  // ðŸ”— Relations
  projects        Project[]
  invoices        Invoice[]
  expenses        Expense[]
  interactionLogs InteractionLog[]
  followUps       FollowUpSuggestion[]
  documents       DocumentVault[]

  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
}

model Project {
  id               String         @id @default(cuid())
  clientId         String
  client           CurrentClient  @relation(fields: [clientId], references: [id])

  name             String
  description      String?        // brief overview
  status           ProjectStatus  @default(PLANNING)
  priority         ProjectPriority @default(MEDIUM)
  startDate        DateTime?      // planned or actual
  dueDate          DateTime?      // expected completion
  budget           Float?         // optional budget estimate
  techStack        Json           // e.g. ["Next.js", "Tailwind", "Node.js"]
  devNotes         String?        // internal notes for development
  tasks            Task[]         // detailed breakdown
  milestones       Milestone[]    // key checkpoints
  attachments      ProjectFile[]  // designs, mockups, docs
  aiRecommendations Json?         // (optional) AI-generated suggestions, can split out later

  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model Task {
  id          String        @id @default(cuid())
  projectId   String
  project     Project       @relation(fields: [projectId], references: [id])

  title       String
  details     String?
  status      TaskStatus    @default(PENDING)
  assignee    String?       // contractor name or ID
  dueDate     DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now()) @updatedAt
}

model Milestone {
  id          String        @id @default(cuid())
  projectId   String
  project     Project       @relation(fields: [projectId], references: [id])

  title       String
  description String?
  targetDate  DateTime?
  completed   Boolean       @default(false)
  createdAt   DateTime      @default(now())
}

model ProjectFile {
  id          String        @id @default(cuid())
  projectId   String
  project     Project       @relation(fields: [projectId], references: [id])

  name        String
  url         String        // storage link (S3, GDrive, etc.)
  type        FileType      // DESIGN, CONTRACT, RESOURCE
  uploadedBy  String?
  createdAt   DateTime      @default(now())
}

model InteractionLog {
  id             String        @id @default(cuid())
  clientId       String
  client         CurrentClient @relation(fields: [clientId], references: [id])

  type           InteractionType
  content        String
  nextActionDate DateTime?
  createdAt      DateTime      @default(now())
}

model FollowUpSuggestion {
  id             String        @id @default(cuid())
  clientId       String
  client         CurrentClient @relation(fields: [clientId], references: [id])

  suggestion     String
  priority       FollowUpPriority @default(MEDIUM)
  dueDate        DateTime?
  isCompleted    Boolean        @default(false)
  createdAt      DateTime       @default(now())
}

model DocumentVault {
  id          String        @id @default(cuid())
  clientId    String
  client      CurrentClient @relation(fields: [clientId], references: [id])

  name        String
  url         String
  type        DocumentType
  uploadedBy  String?
  createdAt   DateTime      @default(now())
}

/* ===== Enums ===== */

enum PaymentTerms {
  THIRTY_SEVENTY
  FIFTY_FIFTY
  SEVENTY_THIRTY
  ZERO_FULL
  FULL_ZERO
  CUSTOM_TERMS
}

enum ClientStatus {
  ACTIVE
  INACTIVE
  PAST
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  REVIEW
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum ProjectPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  REVIEW
  DONE
}

// Defines the kind of interaction that took place
enum InteractionType {
  EMAIL_SENT
  EMAIL_RECEIVED
  PHONE_CALL
  VIDEO_CALL
  MEETING
  NOTE_ADDED // For general internal notes about the lead
}
enum FollowUpPriority {
  LOW
  MEDIUM
  HIGH
}

enum DocumentType {
  CONTRACT
  PROPOSAL
  DESIGN
  INVOICE
  REPORT
  OTHER
}

enum FileType {
  DESIGN
  CONTRACT
  RESOURCE
  OTHER
}


model Lead {
  id              Int      @id @default(autoincrement())
  name            String
  email           String
  company         String
  industry        String
  country         String
  dealValue       Int
  currency        String
  leadStage       String
  lastContacted   DateTime
  leadScore       Int
  projectSummary  String

  // --- RELATIONS ---
  contactNotes    Note[]
  interactionLogs InteractionLogLead[] // <-- Each Lead can have multiple interaction logs

  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt
}

model Note {
  id        Int      @id @default(autoincrement())
  content   String
  leadId    Int
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model InteractionLogLead {
  id                  String   @id @default(cuid())
  
  // --- RELATION TO LEAD ---
  leadId              Int
  lead                Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  // --- INTERACTION DETAILS ---
  type                InteractionType // <-- Using the new enum
  content             String          // e.g., "Sent initial outreach email about our services."
  nextActionDate      DateTime?       // Optional: To schedule the next follow-up
  followUpSuggestion  String?         // <-- AI-controlled field for future suggestions

  createdAt           DateTime @default(now())
}


// --- ENUMS ---

enum LeadStage {
  NEW
  CONTACTED
  PROPOSAL_SENT
  NEGOTIATION
  WON
  LOST
}



model Invoice {
  id             String         @id @default(cuid())
  clientId       String
  client         CurrentClient  @relation(fields: [clientId], references: [id])
  amount         Float
  currency       String         // e.g. USD, EUR, INR
  status         InvoiceStatus  @default(PENDING)
  issueDate      DateTime       @default(now())
  dueDate        DateTime
  description    String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @default(now()) @updatedAt
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
}

model Expense {
  id             String        @id @default(cuid())
  clientId       String?       // Optional if expense is linked to a client
  client         CurrentClient? @relation(fields: [clientId], references: [id])
  title          String
  amount         Float
  currency       String        // e.g. INR, USD
  category       String?       // e.g. Hosting, Contractor Payment
  date           DateTime      @default(now())
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @default(now()) @updatedAt
}

model KnowledgeHub {
  id          String    @id @default(cuid())
  title       String
  description String
  type        String    // e.g. "Onboarding", "Code Snippets", "Best Practices"
  content     String    // Markdown
  tags        Json      // e.g. ["Onboarding", "Code Snippets"]
  url         String?   // Optional link to external resources
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
}

model TemplateLibrary {
  id          String    @id @default(cuid())
  name        String    // e.g. "Proposal Template v1"
  type        TemplateType
  content     String    // Markdown/HTML/JSON
  variables   Json      // e.g. ["clientName", "projectScope"] for placeholders
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
}

enum TemplateType {
  PROPOSAL
  INVOICE
  EMAIL
  CONTRACT
  OTHER
}


// prisma/schema.prisma

model PricingCategory {
  id        Int           @id @default(autoincrement())
  title     String
  plans     PricingPlan[]
  createdAt DateTime      @default(now())
  updatedAt DateTime      @default(now()) @updatedAt
}

model PricingPlan {
  id                     Int              @id @default(autoincrement())
  name                   String
  description            String
  price                  String
  featured               Boolean          @default(false)
  everythingIncludedPrev Boolean          @default(false)
  
  // Relations
  category               PricingCategory  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId             Int
  
  features               Json

  featuresNotIncluded    Json

  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @default(now()) @updatedAt
}


// --- PORTFOLIO MODELS ---

model PortfolioItem {
  id               Int      @id @default(autoincrement())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @updatedAt

  // Identity
  companyName      String
  companyLogo      String
  industry         String
  location         String
  website          String

  // Hero
  heroLine         String?
  heroImage        String
  
  // Content
  description      String   
  projectDuration  String
  problemStatement String   
  solution         String   
  results          String   

  // Arrays
  services         Json 
  media            Json 

  // Relations (1-to-1)
  testimonial      Testimonial?
  stats            PortfolioStats?
}

model Testimonial {
  id              Int           @id @default(autoincrement())
  quote           String       
  author          String
  designation     String
  
  // Relation
  portfolioItem   PortfolioItem @relation(fields: [portfolioItemId], references: [id], onDelete: Cascade)
  portfolioItemId Int           @unique
}

model PortfolioStats {
  id                     Int           @id @default(autoincrement())
  conversionRateIncrease String?
  trafficGrowth          String?
  userGrowth             String?

  // Relation
  portfolioItem          PortfolioItem @relation(fields: [portfolioItemId], references: [id], onDelete: Cascade)
  portfolioItemId        Int           @unique
}
